<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overview &mdash; OpusFilter latest documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Other command line tools" href="command_line_tools.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> OpusFilter
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#opusfilter-tool">Opusfilter tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-examples">Configuration examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variables-and-constants">Variables and constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-single-command">Running a single command</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_line_tools.html">Other command line tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Available functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="functions/downloading_and_selecting_data.html">Downloading and selecting data</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions/preprocessing_text.html">Preprocessing text</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions/filtering_and_scoring.html">Filtering and scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions/using_score_files.html">Using score files</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions/training_language_and_alignment_models.html">Training language and alignment models</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions/training_and_using_classifiers.html">Training and using classifiers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Available filters</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filters/length_filters.html">Length filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters/script_and_language_identification_filters.html">Script and language identification filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters/special_character_and_similarity_filters.html">Special character and similarity filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters/language_model_filters.html">Language model filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters/alignment_model_filters.html">Alignment model filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters/sentence_embedding_filters.html">Sentence embedding filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters/custom_filters.html">Custom filters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Available preprocessors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="preprocessors/tokenizer.html">Tokenizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessors/detokenizer.html">Detokenizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessors/whitespaceNormalizer.html">WhitespaceNormalizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessors/reg_exp_sub.html">RegExpSub</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessors/monolingual_sentence_splitter.html">MonolingualSentenceSplitter</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessors/bpe_segmentation.html">BPESegmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessors/morfessor_segmentation.html">MorfessorSegmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessors/custom_preprocessors.html">Custom preprocessors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references.html">Citing and references</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpusFilter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h1>
<section id="opusfilter-tool">
<h2>Opusfilter tool<a class="headerlink" href="#opusfilter-tool" title="Permalink to this headline"></a></h2>
<p>The main script provided by the package is <code class="docutils literal notranslate"><span class="pre">opusfilter</span></code>, which takes
a configuration file as an input. The configuration files are in
<a class="reference external" href="https://yaml.org/">YAML</a> format. At the top level, they have to
sections:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">common</span></code>, which includes global options, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">steps</span></code>, which is a list of the corpus processing steps.</p></li>
</ul>
<p>The syntax for the <code class="docutils literal notranslate"><span class="pre">opusfilter</span></code> is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opusfilter</span> <span class="p">[</span><span class="o">--</span><span class="n">overwrite</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">last</span> <span class="n">LAST</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">single</span> <span class="n">SINGLE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">n</span><span class="o">-</span><span class="n">jobs</span> <span class="n">N_JOBS</span><span class="p">]</span> <span class="n">CONFIG</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code> is path to the configuration file.
The script will run the steps one by one and stops when the final step
has been processed (if no exceptions were raised). The script has
options for setting the last step to run (<code class="docutils literal notranslate"><span class="pre">--last</span></code>) and running
only a single step (<code class="docutils literal notranslate"><span class="pre">--single</span></code>). It the latter, the user has to
make sure that all input files for the step already exist. The first
step has number 1, and -1 points to the last step, -2 to the second to
last, and so on. The <code class="docutils literal notranslate"><span class="pre">--n-jobs</span></code> option indicate number of processes to
use when running <code class="docutils literal notranslate"><span class="pre">score</span></code>, <code class="docutils literal notranslate"><span class="pre">filter</span></code> and <code class="docutils literal notranslate"><span class="pre">preprocess</span></code> steps. This value will
overwrite <code class="docutils literal notranslate"><span class="pre">default_n_jobs</span></code> in the <code class="docutils literal notranslate"><span class="pre">common</span></code> section.</p>
<p>By default, existing output files will be re-used, and the steps
producing them skipped. The <code class="docutils literal notranslate"><span class="pre">--overwrite</span></code> option will force overwrite
for all the steps.</p>
<p>The valid options for the <code class="docutils literal notranslate"><span class="pre">common</span></code> section includes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">output_directory</span></code> for setting where to write the output files. If
it is not set, the current working directory is used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chunksize</span></code> for changing the default chunk size option for <code class="docutils literal notranslate"><span class="pre">filter</span></code>
(with <code class="docutils literal notranslate"><span class="pre">filterfalse</span></code> option) and <code class="docutils literal notranslate"><span class="pre">score</span></code> steps. Increasing the value
from the default 100000 may speed up things at the cost of increased
memory use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_n_jobs</span></code> for defining the number of parallel processes to use
for <code class="docutils literal notranslate"><span class="pre">score</span></code>, <code class="docutils literal notranslate"><span class="pre">filter</span></code>, and <code class="docutils literal notranslate"><span class="pre">preprocess</span></code> steps. The default value is 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">constants</span></code> for setting constants; see
<a class="reference internal" href="#variables-and-constants"><span class="std std-doc">Variables and constants</span></a>.</p></li>
</ul>
<p>Each step in <code class="docutils literal notranslate"><span class="pre">steps</span></code> is a dictionary (mapping) with two keys: <code class="docutils literal notranslate"><span class="pre">type</span></code>
and <code class="docutils literal notranslate"><span class="pre">parameters</span></code>. Type is a string that defines the function that
should be run, and parameters is a dictionary with keys that depend on
the function; at minimum the output files are defined there.</p>
</section>
<section id="configuration-examples">
<h2>Configuration examples<a class="headerlink" href="#configuration-examples" title="Permalink to this headline"></a></h2>
<p>A very simple configuration file that downloads a parallel corpus
(here Finnish-English ParaCrawl v4) from OPUS and stores its segments
to the files <code class="docutils literal notranslate"><span class="pre">paracrawl.fi.gz</span></code> and <code class="docutils literal notranslate"><span class="pre">paracrawl.en.gz</span></code> looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opus_read</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">corpus_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ParaCrawl</span><span class="w"></span>
<span class="w">      </span><span class="nt">source_language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fi</span><span class="w"></span>
<span class="w">      </span><span class="nt">target_language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">en</span><span class="w"></span>
<span class="w">      </span><span class="nt">release</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v4</span><span class="w"></span>
<span class="w">      </span><span class="nt">preprocessing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw</span><span class="w"></span>
<span class="w">      </span><span class="nt">src_output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">tgt_output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl.en.gz</span><span class="w"></span>
</pre></div>
</div>
<p>The corpus files processed by OpusFilter are UTF-8 text files that
contain one segment per line. Compressed files are read and written if
the file ends with <code class="docutils literal notranslate"><span class="pre">.gz</span></code> (gzip) or <code class="docutils literal notranslate"><span class="pre">.bz2</span></code> (bzip2).</p>
<p>A bit more complex example that downloads both ParaCrawl and WMT-News
sets from OPUS, concatenates the output files, and filters them so
that only the segment pairs for which both languages have segment
length of 1-100 words and the ratio of the lengths is at most 3
remain:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opus_read</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">corpus_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ParaCrawl</span><span class="w"></span>
<span class="w">      </span><span class="nt">source_language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fi</span><span class="w"></span>
<span class="w">      </span><span class="nt">target_language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">en</span><span class="w"></span>
<span class="w">      </span><span class="nt">release</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v4</span><span class="w"></span>
<span class="w">      </span><span class="nt">preprocessing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw</span><span class="w"></span>
<span class="w">      </span><span class="nt">src_output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">tgt_output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl.en.gz</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opus_read</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">corpus_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WMT-News</span><span class="w"></span>
<span class="w">      </span><span class="nt">source_language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fi</span><span class="w"></span>
<span class="w">      </span><span class="nt">target_language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">en</span><span class="w"></span>
<span class="w">      </span><span class="nt">release</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2019</span><span class="w"></span>
<span class="w">      </span><span class="nt">preprocessing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">raw</span><span class="w"></span>
<span class="w">      </span><span class="nt">src_output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wmt.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">tgt_output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wmt.en.gz</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">concatenate</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wmt.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all.fi.gz</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">concatenate</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl.en.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wmt.en.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all.en.gz</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all.en.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">outputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filtered.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filtered.en.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">filters</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">LengthFilter</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">word</span><span class="w"></span>
<span class="w">            </span><span class="nt">min_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">            </span><span class="nt">max_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w"></span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">LengthRatioFilter</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">word</span><span class="w"></span>
<span class="w">            </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
</pre></div>
</div>
<p>YAML node anchors (<code class="docutils literal notranslate"><span class="pre">&amp;name</span></code>) and references (<code class="docutils literal notranslate"><span class="pre">*name</span></code>) can be used. They
are especially useful when defining a set of filters you want to use
for different data sets. For example, if in the previous example you
wanted to use the same filters separately for the ParaCrawl and
WMT-News data, you can have:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl.en.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">outputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl_filtered.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paracrawl_filtered.en.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">filters</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;myfilters</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">LengthFilter</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">word</span><span class="w"></span>
<span class="w">            </span><span class="nt">min_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">            </span><span class="nt">max_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w"></span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">LengthRatioFilter</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">word</span><span class="w"></span>
<span class="w">            </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filter</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wmt.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wmt.en.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">outputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wmt_filtered.fi.gz</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wmt_filtered.en.gz</span><span class="w"></span>
<span class="w">      </span><span class="nt">filters</span><span class="p">:</span><span class="w"> </span><span class="nv">*myfilters</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="variables-and-constants">
<h2>Variables and constants<a class="headerlink" href="#variables-and-constants" title="Permalink to this headline"></a></h2>
<p>If you have for example multiple bitexts, for which you want to use
the same preprocessing steps, writing separate steps for each of them
requires a lot of manually written configuration. While generating the
YAML configuration programmatically is a recommended option especially
for very complex setups, OpusFilter provides a couple of custom YAML
tags for defining objects that can be replaced with constant or
variable values.</p>
<p>The first tag, <code class="docutils literal notranslate"><span class="pre">!var</span></code>, is used for mapping the variable name (string)
to its value. For example, if the variable or constant <code class="docutils literal notranslate"><span class="pre">x</span></code> is one in
the current scope, <code class="docutils literal notranslate"><span class="pre">{key:</span> <span class="pre">!var</span> <span class="pre">x}</span></code> will be replaced by <code class="docutils literal notranslate"><span class="pre">{key:</span> <span class="pre">1}</span></code>.
The value can be any kind of object.</p>
<p>The second tag, <code class="docutils literal notranslate"><span class="pre">!varstr</span></code>, can be used for one or more variable
substitutions within a single string, as in Python’s <code class="docutils literal notranslate"><span class="pre">format()</span></code>
method. For example, if <code class="docutils literal notranslate"><span class="pre">l1</span></code> and <code class="docutils literal notranslate"><span class="pre">l2</span></code> have the values <code class="docutils literal notranslate"><span class="pre">en</span></code> and <code class="docutils literal notranslate"><span class="pre">fi</span></code>,
respectively, in the current scope,
<code class="docutils literal notranslate"><span class="pre">{output:</span> <span class="pre">!varstr</span> <span class="pre">&quot;cleaned.{l1}-{l2}.txt&quot;}</span></code> will be replaced by
<code class="docutils literal notranslate"><span class="pre">{output:</span> <span class="pre">cleaned.en-fi.txt}</span></code>.
Note that the string template has to be quoted in order that the YAML
loader will not consider the expressions inside the braces as objects.</p>
<p>Constant values for the variables can be defined in the <code class="docutils literal notranslate"><span class="pre">common</span></code>
section of the configuration, having a scope in all steps, or in
individual steps, having a local scope within the step. In either
case, the definitions are placed in a dictionary under the <code class="docutils literal notranslate"><span class="pre">constants</span></code>
key, with variable names as keys. For example,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">common</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">constants</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">en</span><span class="w"></span>

<span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">concatenate</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="kt">!varstr</span><span class="w"> </span><span class="s">&quot;file1.{source}-{target}.gz&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="kt">!varstr</span><span class="w"> </span><span class="s">&quot;file2.{source}-{target}.gz&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="kt">!varstr</span><span class="w"> </span><span class="s">&quot;all.{source}-{target}.gz&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">constants</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fi</span><span class="w"></span>
</pre></div>
</div>
<p>will produce the output file <code class="docutils literal notranslate"><span class="pre">&quot;all.en-fi.gz&quot;</span></code>. The local scope of the
step overrides definitions in <code class="docutils literal notranslate"><span class="pre">common</span></code>.</p>
<p>Another possibility is to define multiple choices for the variable(s)
within a single step. The definitions are placed in a dictionary under
the <code class="docutils literal notranslate"><span class="pre">variables</span></code> key, with variable names as keys and a list of
intended variable values as values. For example,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">common</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">constants</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">en</span><span class="w"></span>

<span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">concatenate</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="kt">!varstr</span><span class="w"> </span><span class="s">&quot;file1.{source}-{target}.gz&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="kt">!varstr</span><span class="w"> </span><span class="s">&quot;file2.{source}-{target}.gz&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="kt">!varstr</span><span class="w"> </span><span class="s">&quot;all.{source}-{target}.gz&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">variables</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">fi</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sv</span><span class="p p-Indicator">]</span><span class="w"></span>
</pre></div>
</div>
<p>will produce output files <code class="docutils literal notranslate"><span class="pre">&quot;all.en-fi.gz&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;all.en-sv.gz&quot;</span></code>. If
values are defined for multiple variables, the list are required to
have the same length. The step is expanded into as many substeps as
there are values in the lists. Note that if you need to use the
same lists of variable values in multiple steps, you can exploit
the standard YAML node anchors and references.</p>
</section>
<section id="running-a-single-command">
<h2>Running a single command<a class="headerlink" href="#running-a-single-command" title="Permalink to this headline"></a></h2>
<p>If you need to run a single OpusFilter function wihtout the need of
writing a complete configuration, the script <code class="docutils literal notranslate"><span class="pre">opusfilter-cmd</span></code> is
provided for convenience. With the command, you can define a
single-step configuration using just command line arguments.</p>
<p>The syntax for the <code class="docutils literal notranslate"><span class="pre">opusfilter-cmd</span></code> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opusfilter</span><span class="o">-</span><span class="n">cmd</span> <span class="p">[</span><span class="o">--</span><span class="n">overwrite</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">outputdir</span> <span class="n">OUTDIR</span><span class="p">]</span> <span class="n">FUNCTION</span> <span class="p">[</span><span class="o">--</span><span class="n">parameters</span> <span class="n">PARAMETERS</span><span class="p">]</span> <span class="p">[</span><span class="n">PARAMETER</span><span class="o">-</span><span class="n">OPTION</span><span class="p">]</span> <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--outputdir</span></code> option defines the work directory; if not given the
current directory is used. Existing output files will not be
overwritten by default; the <code class="docutils literal notranslate"><span class="pre">--overwrite</span></code> option will force overwrite.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">FUNCTION</span></code> argument defines the function to use. Parameters for
the function can be defined in two ways: Providing a single JSON
object (as a string) that corresponds to the parameter definition in
YAML configuration, or setting the parameters with custom options.</p>
<p>For the former, use the <code class="docutils literal notranslate"><span class="pre">--parameters</span></code> option. For example, the
following performs filtering with a single word length filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opusfilter</span><span class="o">-</span><span class="n">cmd</span> <span class="nb">filter</span> <span class="o">--</span><span class="n">parameters</span> <span class="p">{</span><span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;wmt.fi.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;wmt.en.gz&quot;</span><span class="p">],</span> <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;wmt_filtered.fi.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;wmt_filtered.en.gz&quot;</span><span class="p">],</span> <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;LengthFilter&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;word&quot;</span><span class="p">,</span> <span class="s2">&quot;min_length&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}}]}</span>
</pre></div>
</div>
<p>Writing a valid complex JSON object may be difficult, and the custom
parameter options help with that. You can replace each top-level key
(e.g. <code class="docutils literal notranslate"><span class="pre">inputs</span></code>) in the parameters with a corresponding option
(<code class="docutils literal notranslate"><span class="pre">--inputs</span></code>) followed by its value, again as a JSON object. A value
that cannot be parsed as JSON will be assumed to be a string. If
multiple values are given for the same option, or the same option is
given multiple times, the value is assumed to be a list containing all
the values. For providing a list of a single value, use the JSON
notation (e.g. <code class="docutils literal notranslate"><span class="pre">'[&quot;value&quot;]'</span></code>). Any dashes in the option name will be
replaced by underscores (e.g. <code class="docutils literal notranslate"><span class="pre">--corpus-name</span></code> can be used to produce
the <code class="docutils literal notranslate"><span class="pre">corpus_name</span></code> parameter).</p>
<p>In this manner, the above example can be written also as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opusfilter</span><span class="o">-</span><span class="n">cmd</span> <span class="nb">filter</span> <span class="o">--</span><span class="n">inputs</span> <span class="n">wmt</span><span class="o">.</span><span class="n">fi</span><span class="o">.</span><span class="n">gz</span> <span class="n">wmt</span><span class="o">.</span><span class="n">en</span><span class="o">.</span><span class="n">gz</span> <span class="o">--</span><span class="n">outputs</span> <span class="n">wmt_filtered</span><span class="o">.</span><span class="n">fi</span><span class="o">.</span><span class="n">gz</span> <span class="n">wmt_filtered</span><span class="o">.</span><span class="n">en</span><span class="o">.</span><span class="n">gz</span> <span class="o">--</span><span class="n">filters</span> <span class="s1">&#39;[{&quot;LengthFilter&quot;: {&quot;unit&quot;: &quot;word&quot;, &quot;min_length&quot;: 1, &quot;max_length&quot;: 100}}]&#39;</span>
</pre></div>
</div>
<p>Note that the filters still need to be defined as a complex JSON
objects. The created configuration will be shown as YAML for easier
checking and storing.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="command_line_tools.html" class="btn btn-neutral float-right" title="Other command line tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>